<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Danh mục</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</head>
<body>
<div class="container mt-5">

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div th:if="${mess != null}" id="liveToast" class="toast text-bg-success" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Thông báo hệ thống</strong>
                <small>Vừa xong</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <span th:text="${mess}"></span>
            </div>
        </div>
    </div>

    <h2>Quản lý Danh mục</h2>
    <div class="mb-3 d-flex justify-content-between">
        <a class="btn btn-success" th:href="@{/categories/create}">Thêm mới Danh mục</a>
        <a class="btn btn-secondary" th:href="@{/blogs}">Về Danh sách Blog</a>
    </div>

    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>Tên Danh mục</th>
            <th colspan="2">Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cat : ${categoryList}">
            <td th:text="${cat.id}"></td>
            <td th:text="${cat.name}"></td>
            <td>
                <a class="btn btn-secondary btn-sm" th:href="@{/categories/edit/__${cat.id}__}">Sửa</a>
                <button class="btn btn-danger btn-sm delete-btn" data-bs-toggle="modal"
                        data-bs-target="#deleteModal" th:attr="data-id=${cat.id}, data-name=${cat.name}">Xóa</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận xóa Danh mục</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa Danh mục: <strong id="categoryName"></strong> không?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <a id="confirmDeleteButton" href="#" class="btn btn-danger">Xóa</a>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Cập nhật URL xóa trong Modal
        $('.delete-btn').on('click', function() {
            var categoryId = $(this).data('id');
            var categoryName = $(this).data('name');
            var deleteUrl = '/categories/delete/' + categoryId;
            $('#categoryName').text(categoryName);
            $('#confirmDeleteButton').attr('href', deleteUrl);
        });

        // Kích hoạt Toast Message
        var toastEl = document.getElementById('liveToast');
        if (toastEl) {
            var toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }
    });
</script>
</body>
</html>